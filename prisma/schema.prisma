
datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

// ============ ENUMS ============

enum Role {
  ADMIN
  MANAGER
  CASHIER
  SUPPLIER
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum TransactionStatus {
  COMPLETED
  PENDING
  FAILED
  VOIDED
}

enum PaymentMethod {
  CASH
  MTN_MONEY
  AIRTEL_MONEY
  CARD
  SPLIT
}

enum OrderStatus {
  PENDING
  APPROVED
  SHIPPED
  DELIVERED
  CANCELLED
}

enum SupplierStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum ReturnStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
}

enum DocumentType {
  INVOICE
  DELIVERY_NOTE
  CONTRACT
  CERTIFICATE
  OTHER
}

enum NotificationType {
  ORDER
  PAYMENT
  ALERT
  MESSAGE
  WARNING
  SUCCESS
  INFO
  ERROR
}

enum NotificationStatus {
  UNREAD
  READ
}

enum TaxType {
  PERCENTAGE
  FIXED
}

enum PaymentStatus {
  PENDING
  PAID
  OVERDUE
  PARTIALLY_PAID
}

// ============ USER MODELS ============

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  username      String   @unique
  passwordHash  String
  role          Role     @default(CASHIER)
  fullName      String
  phone         String?
  status        UserStatus @default(ACTIVE)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  stores        StoreUser[]
  auditLogs     AuditLog[]
  transactions  Transaction[]
  purchaseOrders PurchaseOrder[]
  notifications Notification[]

  @@map("users")
}

// ============ STORE MODELS ============

model Store {
  id            String   @id @default(cuid())
  name          String
  location      String
  managerId     String?
  managerName   String?
  status        UserStatus @default(ACTIVE)
  revenue       Float    @default(0)
  employees     Int      @default(0)
  phone         String?
  email         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  users         StoreUser[]
  inventory     InventoryItem[]
  transactions  Transaction[]
  invoices      Invoice[]
  communications Communication[]

  @@map("stores")
}

model StoreUser {
  id            String   @id @default(cuid())
  userId        String
  storeId       String
  createdAt     DateTime @default(now())

  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  store         Store    @relation(fields: [storeId], references: [id], onDelete: Cascade)

  @@unique([userId, storeId])
  @@map("store_users")
}

// ============ PRODUCT & INVENTORY MODELS ============

model ProductCategory {
  id            String   @id @default(cuid())
  name          String   @unique
  description   String?
  status        UserStatus @default(ACTIVE)
  productCount  Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  products      Product[]

  @@map("product_categories")
}

model Product {
  id            String   @id @default(cuid())
  name          String
  sku           String   @unique
  barcode       String   @unique
  categoryId    String
  description   String?
  costPrice     Float
  retailPrice   Float
  image         String?
  status        UserStatus @default(ACTIVE)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  category      ProductCategory @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  inventory     InventoryItem[]
  transactionItems TransactionItem[]
  purchaseOrderItems PurchaseOrderItem[]

  @@map("products")
}

model InventoryItem {
  id            String   @id @default(cuid())
  productId     String
  storeId       String
  stock         Int      @default(0)
  reorderLevel  Int      @default(0)
  supplier      String?
  expiryDate    DateTime?
  batchNumber   String?
  lastRestocked DateTime?
  soldThisMonth Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  product       Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  store         Store    @relation(fields: [storeId], references: [id], onDelete: Cascade)

  @@unique([productId, storeId])
  @@map("inventory_items")
}

// ============ TRANSACTION MODELS ============

model Transaction {
  id            String   @id @default(cuid())
  transactionNumber String @unique
  storeId       String
  userId        String?
  totalAmount   Float
  payment       PaymentMethod
  status        TransactionStatus @default(COMPLETED)
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  store         Store    @relation(fields: [storeId], references: [id], onDelete: Restrict)
  user          User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  items         TransactionItem[]
  customer      Customer? @relation(fields: [customerId], references: [id], onDelete: SetNull)
  customerId    String?

  @@map("transactions")
}

model TransactionItem {
  id            String   @id @default(cuid())
  transactionId String
  productId     String
  quantity      Int
  unitPrice     Float
  totalPrice    Float
  createdAt     DateTime @default(now())

  // Relations
  transaction   Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  product       Product  @relation(fields: [productId], references: [id], onDelete: Restrict)

  @@map("transaction_items")
}

// ============ CUSTOMER MODELS ============

model Customer {
  id            String   @id @default(cuid())
  name          String
  phone         String?  @unique
  email         String?  @unique
  loyaltyPoints Int      @default(0)
  tier          String   @default("Bronze")
  totalSpent    Float    @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  transactions  Transaction[]
  returns       Return[]

  @@map("customers")
}

// ============ RETURN & REFUND MODELS ============

model Return {
  id            String   @id @default(cuid())
  transactionId String?
  customerId    String
  itemCount     Int
  amount        Float
  reason        String
  status        ReturnStatus @default(PENDING)
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  customer      Customer @relation(fields: [customerId], references: [id], onDelete: Restrict)

  @@map("returns")
}

// ============ SUPPLIER MODELS ============

model Supplier {
  id            String   @id @default(cuid())
  name          String
  contactPerson String?
  phone         String?
  email         String?
  category      String?
  status        SupplierStatus @default(ACTIVE)
  paymentTerms  String   @default("Net 30")
  rating        Float    @default(0)
  totalOrders   Int      @default(0)
  totalSpent    Float    @default(0)
  productCount  Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  purchaseOrders PurchaseOrder[]
  products      SupplierProduct[]
  invoices      Invoice[]
  communications Communication[]
  documents     Document[]

  @@map("suppliers")
}

model SupplierProduct {
  id            String   @id @default(cuid())
  supplierId    String
  productName   String
  category      String
  currentPrice  Float
  stock         Int      @default(0)
  lowStockThreshold Int @default(0)
  sku           String   @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  supplier      Supplier @relation(fields: [supplierId], references: [id], onDelete: Cascade)

  @@map("supplier_products")
}

// ============ PURCHASE ORDER MODELS ============

model PurchaseOrder {
  id            String   @id @default(cuid())
  poNumber      String   @unique
  supplierId    String
  storeId       String?
  createdById   String
  totalCost     Float
  status        OrderStatus @default(PENDING)
  orderDate     DateTime @default(now())
  expectedDelivery DateTime?
  actualDelivery DateTime?
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  supplier      Supplier @relation(fields: [supplierId], references: [id], onDelete: Restrict)
  createdBy     User     @relation(fields: [createdById], references: [id], onDelete: Restrict)
  items         PurchaseOrderItem[]

  @@map("purchase_orders")
}

model PurchaseOrderItem {
  id            String   @id @default(cuid())
  purchaseOrderId String
  productId     String
  quantity      Int
  unitCost      Float
  totalCost     Float
  createdAt     DateTime @default(now())

  // Relations
  purchaseOrder PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  product       Product  @relation(fields: [productId], references: [id], onDelete: Restrict)

  @@map("purchase_order_items")
}

// ============ INVOICE MODELS ============

model Invoice {
  id            String   @id @default(cuid())
  invoiceNumber String   @unique
  storeId       String?
  supplierId    String
  amount        Float
  status        PaymentStatus @default(PENDING)
  invoiceDate   DateTime @default(now())
  dueDate       DateTime
  paidDate      DateTime?
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  store         Store?   @relation(fields: [storeId], references: [id], onDelete: SetNull)
  supplier      Supplier @relation(fields: [supplierId], references: [id], onDelete: Restrict)
  payments      Payment[]

  @@map("invoices")
}

model Payment {
  id            String   @id @default(cuid())
  invoiceId     String
  amount        Float
  paymentMethod PaymentMethod
  paymentDate   DateTime @default(now())
  reference     String?
  notes         String?
  createdAt     DateTime @default(now())

  // Relations
  invoice       Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@map("payments")
}

// ============ DOCUMENT MODELS ============

model Document {
  id            String   @id @default(cuid())
  fileName      String
  documentType  DocumentType
  fileSize      String
  category      String?
  supplierId    String?
  storeId       String?
  uploadedDate  DateTime @default(now())
  filePath      String
  createdAt     DateTime @default(now())

  // Relations
  supplier      Supplier? @relation(fields: [supplierId], references: [id], onDelete: SetNull)

  @@map("documents")
}

// ============ COMMUNICATION MODELS ============

model Communication {
  id            String   @id @default(cuid())
  senderId      String?
  senderName    String?
  supplierId    String?
  storeId       String?
  message       String
  status        NotificationStatus @default(UNREAD)
  createdAt     DateTime @default(now())

  // Relations
  supplier      Supplier? @relation(fields: [supplierId], references: [id], onDelete: SetNull)
  store         Store?   @relation(fields: [storeId], references: [id], onDelete: SetNull)

  @@map("communications")
}

// ============ NOTIFICATION MODELS ============

model Notification {
  id            String   @id @default(cuid())
  userId        String
  type          NotificationType
  title         String
  message       String
  status        NotificationStatus @default(UNREAD)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

// ============ SYSTEM MODELS ============

model AuditLog {
  id            String   @id @default(cuid())
  userId        String
  userName      String
  action        String
  target        String?
  targetId      String?
  changes       String?
  ipAddress     String?
  createdAt     DateTime @default(now())

  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Restrict)

  @@map("audit_logs")
}

model TaxConfiguration {
  id            String   @id @default(cuid())
  name          String   @unique
  rate          Float
  taxType       TaxType  @default(PERCENTAGE)
  status        UserStatus @default(ACTIVE)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("tax_configurations")
}

model PaymentGateway {
  id            String   @id @default(cuid())
  name          String   @unique
  status        UserStatus @default(ACTIVE)
  fee           String   @default("0%")
  transactionCount Int   @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("payment_gateways")
}

model SystemSetting {
  id            String   @id @default(cuid())
  key           String   @unique
  value         String
  description   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("system_settings")
}
